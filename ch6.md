# ch06 DI(Dependency Injection)와 서비스 로케이터

## 어플리케이션 영역과 메인 영역

- 어플리케이션 영역
  + 고수준 정책 및 저수준 구현을 포함한 영역
  + SOLID 를 유지하며 추상화가 적절하게 잘 이루어져 있어야 한다고 생각
<br>

- 메인 영역
  + 어플리케이션이 동작하도록 각 객체들을 연결해 주는 영역, 객체를 연결하는 과정에서 DI와 서비스 로케이터를 사용한다
  + 어플리케이션 영역의 객체를 생성하고, 설정하고, 실행하는 책임을 갖는다
  + 어플리케이션 영역에서 사용할 하위 수준의 모듈을 변경하고 싶다면 메인 영역을 수정하게 된다
<br>

#### 모든 의존은 메인 영역에서 어플리케이션 영역으로 향한다
- 반대의 경우인 어플리케이션 영역에서 메인 영역으로의 의존은 존재하지 않는다
- 메인 영역을 변경한다고 해도 어플리케이션 영역은 변경되지 않는다
<br>

***

## DI를 이용한 의존 객체 사용

```java
public class Worker{
  public void run(){
    JobQueue jobQueue = new FileJobQueue(); // DIP 위반, 고수준 모듈이 저수준 모듈에 의존하고 있다
  }
}
```
- 위와 같이 콘크리트 클래스를 직접 사용해서 객체를 생성하게 되면 의존 역전 원칙을 위반하게 된다
- DI는 필요한 객체를 직접 생성하거나 찾지 않고 외부에서 넣어 주는 방식이다
- 사용할 객체를 전달받을 수 있는 방법을 제공하면 DI를 적용할 수 있다
- Main 클래스에서 어플리케이션 영역의 객체를 생성할 때 해당 어플리케이션 클래스의 생성자를 통해 다른 어플리케이션 객체를 넣어준다
- DI를 통해서 의존 객체를 관리할 때에는 객체를 생성하고 각 객체들을 의존 관계에 따라 연결해 주는 조립 기능이 필요하다
- 교재의 예에서는 Main 클래스가 조립기의 역할을 담당했다
- 이 조립기 역할을 별도로 분리하면 향후 조립기 구현 변경의 유연함을 얻을 수 있다

<br>

### < DI :  생성자 방식과 설정 메서드 방식 >

- 생성자 방식
  + 생성자를 통해서 의존 객체를 전달받고 필드에 보관하는 방식
<br>

- 설정 메서드 방식
  + 메서드를 이용해서 의존 객체를 전달받고 필드에 보관, 다른 메서드에서 이 필드에 저장한 의존 객체를 사용해서 기능을 실행한다
<br>

#### 생성자 방식은 생성 시점에 의존 객체를 모두 받기 때문에, 한 번 객체가 생성되면 객체가 정상적으로 동작함을 보장
#### 설정 메서드 방식은 객체를 생성한 뒤 의존 객체를 주입하므로, 의존 객체가 주입되지 않은 상태에서 객체를 사용하다 NullPointerException이 발생할 수 있다

- 어떤 이유로 인해 의존할 객체가 나중에 생성된다면 설정 메서드 방식을 사용해야 한다
<br>

### < DI와 테스트 >
- 단위 테스트는 한 클래스의 기능을 테스트하는데 초점을 맞춘다
- DI 적용 시 특정 클래스의 구현이 완료되어 있지 않아도 Mock 객체를 이용하여 테스트가 가능하다
- 또한 Mock 객체를 생성하기 위해 기존의 다른 코드를 변경할 필요가 없게 된다

<br>

***

## < 서비스 로케이터를 이용한 의존 객체 사용 >

- 서비스 로케이터는 어플리케이션에서 필요로 하는 객체를 제공하는 책임을 갖는다
- 서비스 로케이터가 올바르게 동작하려면 서비스 로케이터 스스로 어떤 객체를 제공해야 할지를 알아야 한다
<br>

### 객체 등록 방식의 서비스 로케이터 구현
- 서비스 로케이터를 생성할 때 사용할 객체를 전달한다
- 서비스 로케이터 인스턴스를 지정하고 참조하기 위한 static 메서드를 제공한다

### 상속을 통한 서비스 로케이터 구현
- 객체를 구하는 추상 메서드를 제공하는 상위 타입 구현
- 상위 타입을 상속받은 하위 타입에서 사용할 객체 설정

<br>

### 서비스 로케이터의 단점
- 서비스 로케이터의 가장 큰 단점은 동일 타입의 객체가 다수 필요한 경우, 각 객체 별로 제공 메서드를 만들어 주어야 한다
- DI는 필요한 객체를 처음에 정하고 주입을 해주기에 유연함이 있다
- 서비스 로케이터는 DI가 가지고 있는 유연함을 떨어뜨리는 문제를 가지고 있기에, 부득이한 상황이 아니라면 서비스 로케이터 보다는 DI를 사용하는 것이 좋다

***
